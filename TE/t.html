<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ULTRA LIGHT PRO - AUTO SCROLL</title>
    <style>
        :root {
            --bg: #050505;
            --accent: #7d00ff;
            --electric-blue: #00d4ff;
            --card-w: 200px;
            --card-h: 300px;
            --focus-left: 5%; /* Posición fija del foco */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* HEADER */
        .header-hero {
            height: 38vh;
            width: 100%;
            background: linear-gradient(160deg, #0a0a20 0%, #000 100%);
            display: flex;
            align-items: center;
            padding: 0 5%;
            border-bottom: 3px solid var(--electric-blue);
            position: relative;
            z-index: 10;
        }

        .hero-img {
            position: absolute;
            right: 0; top: 0;
            width: 50%; height: 100%;
            object-fit: cover;
            mask-image: linear-gradient(to left, black, transparent);
            -webkit-mask-image: linear-gradient(to left, black, transparent);
            opacity: 0.6;
        }

        .event-info { z-index: 2; max-width: 50%; }
        .event-title { font-size: 3rem; font-weight: 900; text-transform: uppercase; line-height: 1; margin-bottom: 10px; }
        .event-desc { color: var(--electric-blue); font-weight: bold; }

        /* CONTENEDOR DE FILAS */
        .viewport-wrapper {
            height: 62vh;
            overflow: hidden;
            position: relative;
        }

        .viewport-content {
            padding: 40px 0;
            transition: transform 0.5s cubic-bezier(0.2, 1, 0.3, 1);
            will-change: transform;
        }

        .row-container {
            margin-bottom: 50px;
            opacity: 0.3;
            transition: opacity 0.4s;
        }
        .row-container.active { opacity: 1; }

        .row-title {
            padding-left: 5%; font-size: 1.2rem; font-weight: bold;
            color: var(--electric-blue); margin-bottom: 15px;
            text-transform: uppercase;
        }

        .strip {
            display: flex;
            gap: 25px;
            padding: 10px 5%;
            transition: transform 0.5s cubic-bezier(0.2, 1, 0.3, 1);
            will-change: transform;
        }

        /* PORTADAS */
        .card {
            flex: 0 0 var(--card-w);
            height: var(--card-h);
            background: #111;
            border-radius: 8px;
            border: 4px solid transparent;
            overflow: hidden;
            position: relative;
            transition: transform 0.3s;
        }

        .card:focus {
            border-color: #fff;
            transform: scale(1.1);
            z-index: 5;
            box-shadow: 0 0 25px rgba(125, 0, 255, 0.5);
        }

        .card img { width: 100%; height: 100%; object-fit: cover; background: #1a1a1a; }

        .card-t {
            position: absolute; bottom: 0; width: 100%;
            background: rgba(0,0,0,0.85);
            font-size: 0.8rem; padding: 10px 5px; text-align: center;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
    </style>
</head>
<body>

<div class="header-hero">
    <img id="hero-bg" class="hero-img" src="">
    <div class="event-info">
        <div class="event-title" id="hero-name">TV PRO MAX</div>
        <div class="event-desc" id="hero-status">Selecciona un contenido</div>
    </div>
</div>

<div class="viewport-wrapper">
    <div class="viewport-content" id="viewport">
        <div class="row-container active" id="row-0" data-index="0">
            <div class="row-title">Canales en Vivo</div>
            <div class="strip"></div>
        </div>
        <div class="row-container" id="row-1" data-index="1">
            <div class="row-title">Cine</div>
            <div class="strip"></div>
        </div>
        <div class="row-container" id="row-2" data-index="2">
            <div class="row-title">Series</div>
            <div class="strip"></div>
        </div>
    </div>
</div>

<script>
    const M3U = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/CV.m3u8";
    const JS = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/data.json";

    let db = { 0: [], 1: [], 2: [] };
    let activeRowIndex = 0;
    let cardPointers = [0, 0, 0]; // Guarda en qué carta estaba el usuario en cada fila

    async function init() {
        try {
            const [resM3U, resJS] = await Promise.all([
                fetch(M3U).then(r => r.text()),
                fetch(JS).then(r => r.json())
            ]);

            // Parseo M3U
            const lines = resM3U.split('\n');
            lines.forEach((l, i) => {
                if(l.includes('#EXTINF')){
                    db[0].push({
                        t: l.split(',')[1]?.trim() || "Canal",
                        img: l.match(/tvg-logo="([^"]+)"/)?.[1] || "",
                        url: lines[i+1]?.trim()
                    });
                }
            });

            // Parseo JSON
            resJS.forEach(item => {
                const obj = { t: item.title, img: item.coverImage || item.img, url: item.video_url, raw: item };
                item.episodes ? db[2].push(obj) : db[1].push(obj);
            });

            render();
        } catch (e) { console.error(e); }
    }

    function render() {
        [0, 1, 2].forEach(rIdx => {
            const row = document.querySelector(`#row-${rIdx}`);
            const strip = row.querySelector('.strip');

            db[rIdx].forEach((item, cIdx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.tabIndex = 0;
                card.innerHTML = `<img src="${item.img}" loading="lazy"><div class="card-t">${item.t}</div>`;

                card.onfocus = () => {
                    activeRowIndex = rIdx;
                    cardPointers[rIdx] = cIdx;

                    // ACTUALIZAR HERO
                    document.getElementById('hero-name').innerText = item.t;
                    document.getElementById('hero-bg').src = item.img;
                    document.getElementById('hero-status').innerText = rIdx === 0 ? "Transmisión en Vivo" : "Presiona OK para ver";

                    // MOVER LA FILA (Efecto: las portadas se mueven, el foco queda a la izquierda)
                    const moveX = cIdx * (200 + 25); // ancho carta + gap
                    strip.style.transform = `translateX(${-moveX}px)`;

                    // MOVER EL VIEWPORT (Efecto: las filas suben/bajan)
                    const moveY = rIdx * 350; // altura fila aprox
                    document.getElementById('viewport').style.transform = `translateY(${-moveY}px)`;

                    // Marcar fila activa
                    document.querySelectorAll('.row-container').forEach((rc, idx) => {
                        rc.classList.toggle('active', idx === rIdx);
                    });
                };

                card.onkeydown = (e) => {
                    if (e.key === 'Enter') {
                        if (item.raw?.episodes) {
                            localStorage.setItem("serie", JSON.stringify(item.raw));
                            window.location.href = "caps.html";
                        } else { window.location.href = item.url; }
                    }

                    // Navegación Vertical Optimizada
                    if (e.key === 'ArrowDown' && rIdx < 2) {
                        e.preventDefault();
                        const nextRow = document.querySelector(`#row-${rIdx + 1} .strip`);
                        const targetCard = nextRow.children[cardPointers[rIdx + 1]] || nextRow.children[0];
                        if(targetCard) targetCard.focus();
                    }
                    if (e.key === 'ArrowUp' && rIdx > 0) {
                        e.preventDefault();
                        const prevRow = document.querySelector(`#row-${rIdx - 1} .strip`);
                        const targetCard = prevRow.children[cardPointers[rIdx - 1]] || prevRow.children[0];
                        if(targetCard) targetCard.focus();
                    }
                };

                strip.appendChild(card);
            });
        });

        // Foco inicial automático
        setTimeout(() => {
            const first = document.querySelector('.card');
            if(first) first.focus();
        }, 500);
    }

    init();
</script>
</body>
</html>
