<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ULTRA LIGHT TV - RAM OPTIMIZED</title>
    <style>
        :root {
            --bg: #050505;
            --accent: #00d4ff;
            --card-w: 240px;
            --card-h: 140px;
            --gap: 25px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        .header-hero {
            height: 45vh;
            width: 100%;
            background: linear-gradient(180deg, rgba(5,5,5,0) 0%, #050505 100%);
            display: flex;
            align-items: center;
            padding: 0 5%;
            position: relative;
        }

        .hero-img {
            position: absolute;
            right: 0; top: 0;
            width: 50%; height: 100%;
            object-fit: contain;
            z-index: -1;
            opacity: 0.4;
            mask-image: linear-gradient(to left, black, transparent);
        }

        .event-info { z-index: 2; }
        .event-title { font-size: 3rem; font-weight: 900; margin-bottom: 5px; }
        .event-desc { color: var(--accent); font-weight: bold; letter-spacing: 2px; }

        .viewport-wrapper {
            height: 50vh;
            overflow: hidden;
            position: relative;
        }

        .strip-container {
            position: relative;
            width: 100%;
            height: 250px;
            padding: 20px 0;
        }

        .strip {
            display: flex;
            position: absolute;
            left: 5%;
            transition: transform 0.3s cubic-bezier(0.2, 0.5, 0.3, 1);
            will-change: transform;
            gap: var(--gap);
        }

        .card {
            flex: 0 0 var(--card-w);
            height: var(--card-h);
            background: #111;
            border-radius: 8px;
            border: 4px solid #222;
            position: relative;
            transition: transform 0.2s;
        }

        .card:focus {
            border-color: var(--accent);
            transform: scale(1.1);
            z-index: 10;
        }

        .card img { 
            width: 100%; height: 100%; 
            object-fit: contain; border-radius: 4px;
            padding: 10px;
        }

        .card-t {
            position: absolute; bottom: -40px; width: 100%;
            text-align: center; font-size: 0.9rem;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* Clase para liberar RAM: oculta contenido de cards lejanas */
        .is-hidden img { display: none; }
    </style>
</head>
<body>

<div class="header-hero">
    <img id="hero-bg" class="hero-img" src="">
    <div class="event-info">
        <div class="event-desc" id="hero-status">INICIALIZANDO...</div>
        <div class="event-title" id="hero-name">SELECCIONE CANAL</div>
    </div>
</div>

<div class="viewport-wrapper">
    <div class="strip-container">
        <div class="strip" id="channel-strip"></div>
    </div>
</div>

<script>
    const M3U_URL = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/CV.m3u8";
    const strip = document.getElementById('channel-strip');
    let channels = [];
    let currentIndex = 0;
    let lastKeyTime = 0;

    async function loadChannels() {
        try {
            const response = await fetch(M3U_URL);
            const data = await response.text();
            parseM3U(data);
        } catch (e) {
            document.getElementById('hero-status').innerText = "ERROR DE CONEXIÓN";
        }
    }

    function parseM3U(content) {
        const lines = content.split('\n');
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].includes('#EXTINF')) {
                const name = lines[i].split(',')[1]?.trim() || "Canal";
                const logo = lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "";
                const url = lines[i + 1]?.trim();
                if (url && url.startsWith('http')) channels.push({ name, logo, url });
            }
        }
        renderInitial();
    }

    function renderInitial() {
        document.getElementById('hero-status').innerText = "LIVE TV";
        channels.forEach((ch, idx) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.tabIndex = 0;
            // Solo cargamos imagen si está cerca del inicio para ahorrar RAM inicial
            const imgSrc = idx < 5 ? ch.logo : ""; 
            card.innerHTML = `
                <img src="${imgSrc}" data-src="${ch.logo}" onerror="this.src='https://via.placeholder.com/240x140?text=TV'">
                <div class="card-t">${ch.name}</div>
            `;

            card.onfocus = () => handleFocus(idx);
            card.onkeydown = (e) => { if(e.key === 'Enter') window.location.href = ch.url; };
            strip.appendChild(card);
        });
        strip.children[0]?.focus();
    }

    function handleFocus(idx) {
        const now = Date.now();
        const diff = now - lastKeyTime;
        lastKeyTime = now;

        let jump = 1;
        // Si el usuario pulsa muy rápido (menos de 150ms), saltamos de 4 en 4
        if (diff < 150) {
            jump = 4;
        } else if (diff < 250) {
            jump = 2;
        }

        currentIndex = idx;
        updateView(jump);
    }

    function updateView(jump) {
        const cardWidth = 240 + 25; // Ancho + Gap
        const offset = -(currentIndex * cardWidth);
        strip.style.transform = `translateX(${offset}px)`;

        // Actualizar Hero
        const ch = channels[currentIndex];
        document.getElementById('hero-name').innerText = ch.name;
        document.getElementById('hero-bg').src = ch.logo;

        // GESTIÓN DE RAM: Virtualización manual
        const allCards = strip.children;
        for (let i = 0; i < allCards.length; i++) {
            const card = allCards[i];
            const img = card.querySelector('img');
            
            // Si la card está lejos del foco (más de 5 posiciones)
            if (Math.abs(i - currentIndex) > 6) {
                if (!card.classList.contains('is-hidden')) {
                    card.classList.add('is-hidden');
                    img.src = ""; // Borrar imagen de RAM
                }
            } else {
                // Cargar imagen si vuelve a estar cerca
                if (card.classList.contains('is-hidden') || img.src === "") {
                    card.classList.remove('is-hidden');
                    img.src = img.getAttribute('data-src');
                }
            }
        }
    }

    // Control de navegación por flechas para manejar el "salto" de 2 en 2 o 4 en 4
    window.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
            const now = Date.now();
            const speed = now - lastKeyTime;
            let step = 1;

            if (speed < 100) step = 4;
            else if (speed < 200) step = 2;

            if (e.key === 'ArrowRight' && currentIndex + step < channels.length) {
                e.preventDefault();
                strip.children[currentIndex + step].focus();
            } else if (e.key === 'ArrowLeft' && currentIndex - step >= 0) {
                e.preventDefault();
                strip.children[currentIndex - step].focus();
            }
        }
    });

    loadChannels();
</script>

</body>
</html>
