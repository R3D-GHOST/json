<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA LIGHT PRO - ELECTRIC EDITION</title>
    <style>
        :root { 
            --bg: #020308; 
            --accent: #7d00ff; 
            --electric-blue: #00d4ff;
            --electric-purple: #9b30ff;
            --glass: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; outline: none; }
        
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg); 
            color: #fff; 
            overflow: hidden; 
            height: 100vh; 
            margin: 0; 
        }

        /* HEADER ELÉCTRICO */
        .header-hero {
            height: 220px;
            width: 100%;
            background: linear-gradient(135deg, #050a1f 0%, #1a0b2e 100%);
            display: flex;
            align-items: center;
            padding: 0 50px;
            border-bottom: 2px solid var(--electric-blue);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header-hero::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at 80%, var(--electric-purple) -50%, transparent 60%);
            opacity: 0.4;
        }

        .event-info { z-index: 2; max-width: 600px; }
        .event-label { 
            background: var(--electric-blue); color: #000; 
            padding: 4px 12px; font-weight: 900; font-size: 0.7rem; 
            border-radius: 3px; letter-spacing: 1px;
        }
        .event-title { font-size: 2.5rem; font-weight: 900; margin: 10px 0; text-transform: uppercase; text-shadow: 0 0 10px var(--electric-blue); }
        .event-status { color: #00ff88; font-size: 0.9rem; font-weight: bold; }

        /* VIEWPORT Y NAVEGACIÓN */
        .viewport { 
            padding-top: 20px; 
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            height: calc(100vh - 220px);
        }
        
        .row-container { 
            margin-bottom: 20px; 
            opacity: 0.4; 
            transition: opacity 0.3s; 
        }
        .row-container.active { opacity: 1; }
        
        .row-title { 
            margin-left: 50px; font-size: 1rem; font-weight: bold; 
            color: var(--electric-blue); margin-bottom: 10px; 
            text-transform: uppercase; letter-spacing: 2px;
        }

        .strip { 
            display: flex; gap: 15px; padding: 10px 50px;
            transition: transform 0.4s cubic-bezier(0.2, 0, 0.2, 1);
        }

        .card { 
            flex: 0 0 160px; aspect-ratio: 2/3; 
            background: #0a0a15; 
            border-radius: 8px; border: 2px solid #222; 
            overflow: hidden; position: relative;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card:focus { 
            border-color: var(--electric-blue); 
            transform: scale(1.15); 
            z-index: 10; 
            box-shadow: 0 0 25px var(--electric-purple);
        }

        .card img { width: 100%; height: 100%; object-fit: cover; }
        
        .card-t { 
            position: absolute; bottom: 0; width: 100%; 
            background: linear-gradient(transparent, #000); 
            font-size: 0.7rem; padding: 15px 5px 5px; text-align: center;
        }

        /* Animación de carga */
        .loading { border-bottom: 2px solid var(--electric-blue); animation: scan 2s infinite; }
        @keyframes scan { 0% { width: 0%; } 100% { width: 100%; } }
    </style>
</head>
<body>

<div class="header-hero" id="header-hero">
    <div class="event-info">
        <span class="event-label">EN DIRECTO</span>
        <div class="event-title" id="hero-name">CARGANDO...</div>
        <div class="event-status" id="hero-status">Sincronizando señal eléctrica...</div>
    </div>
</div>

<div class="viewport" id="viewport">
    <div class="row-container active" id="row-0"><div class="row-title">Canales</div><div class="strip"></div></div>
    <div class="row-container" id="row-1"><div class="row-title">Películas</div><div class="strip"></div></div>
    <div class="row-container" id="row-2"><div class="row-title">Series</div><div class="strip"></div></div>
</div>

<script>
    const M3U = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/CV.m3u8";
    const JS = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/data.json";

    let db = { 0: [], 1: [], 2: [] };
    let curR = 0, curC = 0;
    let eventLink = "";

    async function init() {
        try {
            const [r1, r2] = await Promise.all([
                fetch(M3U).then(r => r.text()),
                fetch(JS).then(r => r.json())
            ]);

            // Parseo M3U
            const lines = r1.split('\n');
            lines.forEach((l, i) => {
                if(l.includes('#EXTINF')) {
                    const info = {
                        t: l.split(',')[1] || "Canal TV",
                        img: l.match(/tvg-logo="([^"]+)"/)?.[1] || "",
                        url: lines[i+1]?.trim()
                    };
                    db[0].push(info);
                }
            });

            // Parseo JSON
            r2.forEach(item => {
                const o = { t: item.title, img: item.coverImage || item.img, url: item.video_url, raw: item };
                item.episodes ? db[2].push(o) : db[1].push(o);
            });

            setupHero();
            renderRow(0);
            renderRow(1);
            renderRow(2);

            // Foco inicial
            setTimeout(() => document.querySelector('.card').focus(), 500);

        } catch (e) { 
            document.getElementById('hero-name').innerText = "ERROR DE CARGA";
        }
    }

    function setupHero() {
        // Buscar canal de EVENTOS
        const eventChannel = db[0].find(c => c.t.toUpperCase().includes("EVENTOS"));
        const fallbackChannel = db[0][0]; // Primer canal si no hay eventos

        const selected = (eventChannel && eventChannel.url) ? eventChannel : fallbackChannel;
        
        if(selected) {
            document.getElementById('hero-name').innerText = selected.t;
            document.getElementById('hero-status').innerText = "SEÑAL OPTIMIZADA - " + (selected.t.includes("EVENTOS") ? "PRIORIDAD ALTA" : "MODO BACKUP");
            eventLink = selected.url;

            // Al hacer click en el header (o Enter si tuviera foco)
            document.getElementById('header-hero').onclick = () => window.location.href = eventLink;
        }
    }

    function renderRow(rIdx) {
        const strip = document.querySelector(`#row-${rIdx} .strip`);
        db[rIdx].forEach((item, i) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.tabIndex = 0;
            card.innerHTML = `<img src="${item.img}" loading="lazy"><div class="card-t">${item.t}</div>`;
            
            card.onfocus = () => {
                curC = i;
                curR = rIdx;
                
                // Movimiento Automático Horizontal
                const moveX = -(curC * 175); // 160 width + 15 gap
                strip.style.transform = `translateX(${moveX}px)`;

                // Movimiento Automático Vertical
                const viewport = document.getElementById('viewport');
                const moveY = -(curR * 280); // Alto de fila aproximado
                viewport.style.transform = `translateY(${moveY}px)`;

                // Actualizar Opacidad de filas
                document.querySelectorAll('.row-container').forEach((r, idx) => {
                    r.classList.toggle('active', idx === curR);
                });
            };

            card.onkeydown = (e) => {
                if (e.key === 'ArrowRight') strip.children[i + 1]?.focus();
                if (e.key === 'ArrowLeft') strip.children[i - 1]?.focus();
                if (e.key === 'ArrowDown') {
                    const nextRow = document.querySelector(`#row-${rIdx + 1} .strip`);
                    if(nextRow) nextRow.children[0]?.focus();
                }
                if (e.key === 'ArrowUp') {
                    const prevRow = document.querySelector(`#row-${rIdx - 1} .strip`);
                    if(prevRow) prevRow.children[0]?.focus();
                    else window.scrollTo(0,0);
                }
                if (e.key === 'Enter') {
                    if (item.raw && item.raw.episodes) {
                        localStorage.setItem("serie", JSON.stringify(item.raw));
                        window.location.href = "caps.html";
                    } else {
                        window.location.href = item.url;
                    }
                }
            };
            strip.appendChild(card);
        });
    }

    init();
</script>
</body>
</html>
