<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV MINIMAL PRO</title>
    <style>
        :root {
            --bg: #000;
            --accent: #00d4ff;
            --card-w: 260px;
            --card-h: 150px;
            --gap: 20px;
        }

        body {
            background: var(--bg);
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            overflow: hidden;
            height: 100vh;
        }

        /* Hero minimalista */
        .hero {
            height: 40vh;
            padding: 40px 5%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background: linear-gradient(0deg, #000 0%, transparent 100%);
        }

        #hero-title { font-size: 3.5rem; margin: 0; font-weight: 800; text-transform: uppercase; }
        #hero-tag { color: var(--accent); font-size: 1.2rem; letter-spacing: 3px; margin-bottom: 10px; }

        /* Contenedor de canales */
        .main-container {
            height: 60vh;
            padding: 0 5%;
            overflow: hidden;
        }

        .strip-wrapper {
            position: relative;
            width: 100%;
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .strip {
            display: flex;
            gap: var(--gap);
        }

        /* Estilo de Tarjeta */
        .card {
            flex: 0 0 var(--card-w);
            height: var(--card-h);
            background: #0a0a0a;
            border-radius: 8px;
            border: 3px solid transparent;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .card:focus {
            border-color: #fff;
            transform: scale(1.08);
            z-index: 10;
        }

        .card img {
            width: 100%; height: 100%;
            object-fit: contain; padding: 15px;
            opacity: 0; transition: opacity 0.6s ease;
        }

        .card img.visible { opacity: 1; }

        .card-label {
            position: absolute; bottom: -35px; width: 100%;
            text-align: center; font-size: 0.9rem; color: #888;
        }

        .card:focus .card-label { color: #fff; font-weight: bold; }

    </style>
</head>
<body>

<div class="hero">
    <div id="hero-tag">EN VIVO</div>
    <h1 id="hero-title">CARGANDO...</h1>
</div>

<div class="main-container">
    <div class="strip-wrapper" id="wrapper">
        <div class="strip" id="strip"></div>
    </div>
</div>

<script>
    const M3U_URL = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/CV.m3u8";
    const strip = document.getElementById('strip');
    const wrapper = document.getElementById('wrapper');
    const heroTitle = document.getElementById('hero-title');

    async function initTV() {
        try {
            const res = await fetch(M3U_URL);
            const data = await res.text();
            const channels = parseM3U(data);
            render(channels);
        } catch (err) {
            heroTitle.innerText = "ERROR DE CONEXIÓN";
        }
    }

    function parseM3U(text) {
        const lines = text.split('\n');
        const list = [];
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].includes('#EXTINF')) {
                list.push({
                    name: lines[i].split(',')[1]?.trim() || "Canal",
                    logo: lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "",
                    url: lines[i+1]?.trim()
                });
            }
        }
        return list;
    }

    function render(list) {
        list.forEach((ch, idx) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.tabIndex = 0;
            card.innerHTML = `<img data-src="${ch.logo}"><div class="card-label">${ch.name}</div>`;

            card.onfocus = () => {
                heroTitle.innerText = ch.name;
                moveGrid(idx);
                loadImagesQueue(idx);
            };

            card.onclick = card.onkeydown = (e) => {
                if (e.type === 'click' || e.key === 'Enter') {
                    window.location.href = ch.url;
                }
            };

            strip.appendChild(card);
        });

        // Foco inicial
        setTimeout(() => strip.children[0]?.focus(), 500);
    }

    // Scroll de 4 en 4
    function moveGrid(idx) {
        const blockSize = 4;
        const currentBlock = Math.floor(idx / blockSize);
        const cardWidth = 260 + 20; // Ancho + Gap
        const offset = currentBlock * (cardWidth * blockSize);
        wrapper.style.transform = `translateX(${-offset}px)`;
    }

    // Carga de imágenes 2 en 2
    function loadImagesQueue(idx) {
        const cards = strip.children;
        // Cargamos la actual y la siguiente (2 en 2)
        [idx, idx + 1].forEach(i => {
            if (cards[i]) {
                const img = cards[i].querySelector('img');
                if (img && !img.src) {
                    img.src = img.dataset.src;
                    img.onload = () => img.classList.add('visible');
                    img.onerror = () => { img.src = 'https://via.placeholder.com/260x150/111/fff?text=TV'; img.classList.add('visible'); };
                }
            }
        });
    }

    initTV();
</script>
</body>
</html>
