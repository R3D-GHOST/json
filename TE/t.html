<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ULTRA LIGHT TV PRO</title>
    <style>
        :root {
            --bg: #020202;
            --accent: #00d4ff;
            --card-w: 260px;
            --card-h: 146px;
            --gap: 20px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            background: var(--bg);
            color: #fff;
            font-family: 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* Capa de fondo fija para no procesar capas pesadas */
        .bg-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at top right, #111, #020202);
            z-index: -2;
        }

        /* HEADER HERO - Simplificado para rendimiento */
        .hero {
            height: 45vh;
            padding: 40px 5%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            position: relative;
        }

        .hero-title { font-size: 3.5rem; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; }
        .hero-status { color: var(--accent); font-weight: bold; letter-spacing: 3px; font-size: 1rem; }

        /* CONTENEDOR DE ALTO RENDIMIENTO */
        .viewport {
            height: 55vh;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .strip {
            display: flex;
            padding-left: 5%;
            transform: translate3d(0, 0, 0); /* Force GPU */
            transition: transform 0.35s cubic-bezier(0.165, 0.84, 0.44, 1);
            will-change: transform;
            align-items: center;
        }

        .card {
            flex: 0 0 var(--card-w);
            height: var(--card-h);
            margin-right: var(--gap);
            background: #111;
            border-radius: 12px;
            border: 4px solid #1a1a1a;
            position: relative;
            transform: scale(0.95);
            transition: transform 0.2s, border-color 0.2s;
            overflow: hidden;
        }

        .card:focus {
            transform: scale(1.1);
            border-color: #fff;
            z-index: 10;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
        }

        .card img {
            width: 100%; height: 100%;
            object-fit: contain;
            padding: 15px;
            pointer-events: none;
        }

        .card-label {
            position: absolute; bottom: 0; width: 100%;
            background: rgba(0,0,0,0.7);
            padding: 5px; font-size: 0.8rem; text-align: center;
            opacity: 0; transition: opacity 0.2s;
        }

        .card:focus .card-label { opacity: 1; }

        /* Optimización: Ocultar cards fuera de vista */
        .virtual-off { visibility: hidden; pointer-events: none; }
    </style>
</head>
<body>

<div class="bg-overlay"></div>

<div class="hero">
    <div id="h-status" class="hero-status">CARGANDO SISTEMA...</div>
    <div id="h-title" class="hero-title">LIVE TV</div>
</div>

<div class="viewport">
    <div class="strip" id="main-strip"></div>
</div>

<script>
    const M3U_URL = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/CV.m3u8";
    const strip = document.getElementById('main-strip');
    let channels = [];
    let curIdx = 0;
    let lastKey = 0;

    async function init() {
        try {
            const res = await fetch(M3U_URL);
            const text = await res.text();
            parse(text);
        } catch(e) { 
            document.getElementById('h-status').innerText = "ERROR DE CARGA";
        }
    }

    function parse(data) {
        const lines = data.split('\n');
        for(let i=0; i<lines.length; i++) {
            if(lines[i].includes('#EXTINF')) {
                const name = lines[i].split(',')[1]?.trim() || "Canal";
                const logo = lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "";
                const url = lines[i+1]?.trim();
                if(url && url.startsWith('http')) channels.push({name, logo, url});
            }
        }
        render();
    }

    function render() {
        const fragment = document.createDocumentFragment();
        channels.forEach((ch, i) => {
            const div = document.createElement('div');
            div.className = 'card';
            div.tabIndex = 0;
            div.dataset.index = i;
            div.innerHTML = `<img src="" data-src="${ch.logo}"><div class="card-label">${ch.name}</div>`;
            
            div.onfocus = () => handleMove(i);
            div.onkeydown = (e) => { if(e.key === 'Enter') window.location.href = ch.url; };
            fragment.appendChild(div);
        });
        strip.appendChild(fragment);
        document.getElementById('h-status').innerText = "SISTEMA LISTO";
        setTimeout(() => strip.children[0]?.focus(), 500);
    }

    function handleMove(idx) {
        const now = Date.now();
        const delta = now - lastKey;
        lastKey = now;

        curIdx = idx;
        const width = 260 + 20; // card + gap
        strip.style.transform = `translate3d(${-idx * width}px, 0, 0)`;

        // Actualizar Info Hero
        document.getElementById('h-title').innerText = channels[idx].name;

        // MOTOR DE MEMORIA (Virtualización)
        // Solo procesamos si el usuario no está "volando" por la lista
        if (delta > 50) { 
            manageMemory(idx);
        }
    }

    function manageMemory(centerIdx) {
        const cards = strip.children;
        const range = 6; // Cuántas cards tener listas alrededor

        for(let i=0; i<cards.length; i++) {
            const card = cards[i];
            const img = card.querySelector('img');
            const isVisible = Math.abs(i - centerIdx) <= range;

            if (isVisible) {
                card.classList.remove('virtual-off');
                if(!img.src) img.src = img.dataset.src;
            } else {
                card.classList.add('virtual-off');
                img.src = ""; // Flush RAM
            }
        }
    }

    // Navegación inteligente por velocidad
    window.addEventListener('keydown', (e) => {
        if(e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
            const now = Date.now();
            const speed = now - lastKey;
            let step = 1;

            if(speed < 80) step = 4; // Vuela si presionas muy rápido
            else if(speed < 150) step = 2; // Salta de 2 en 2

            if(step > 1) {
                e.preventDefault();
                let target = e.key === 'ArrowRight' ? curIdx + step : curIdx - step;
                target = Math.max(0, Math.min(target, channels.length - 1));
                strip.children[target].focus();
            }
        }
    });

    init();
</script>

</body>
</html>
