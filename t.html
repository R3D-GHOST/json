<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Kawaii Play TV</title>
<meta name="theme-color" content="#0a0a0a">
<meta name="description" content="Plataforma de streaming de anime y series optimizada para Google TV">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@4.0.0/dist/hls.min.js"></script>
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<style>
/* --- Variables y Reset (Mantener) --- */
:root {
    --primary-bg: #0a0a0a;
    --secondary-bg: #141414;
    --card-bg: #1a1a1a;
    --text-primary: #ffffff;
    --text-secondary: #a0a0a0;
    --accent-purple: #9333ea;
    --accent-pink: #ec4899;
    --accent-blue: #3b82f6;
    --border-color: #2a2a2a;
    --watched-color: #10b981;
    --gradient-1: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
    --gradient-2: linear-gradient(135deg, #3b82f6 0%, #9333ea 100%);
    --glass-bg: rgba(26, 26, 26, 0.8);
}
* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}
body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: var(--primary-bg);
    color: var(--text-primary);
    overscroll-behavior-y: contain;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* touch-action: manipulation; -> Eliminado para mejor manejo en TV, aunque es útil en móvil */
}

/* --- TV FOCUS & NAVIGATION OPTIMIZATION (NUEVO/MODIFICADO) --- */

/* Esconder barra de navegación inferior en TV (usar navegación superior/lateral) */
@media (min-width: 769px) {
    .bottom-nav { display: none !important; }
    .main-content { padding-bottom: 0; }
}

/* Estilos de Smart TV (1920px+) y navegación remota (pointer: coarse) */
@media (min-width: 1920px), (pointer: coarse) {
    /* Enfoque universal para elementos interactivos: Liso, visible y sencillo */
    .content-card:focus, 
    .nav-item:focus,
    .header-btn:focus,
    .hero-btn:focus,
    .action-btn:focus,
    .episode-card:focus,
    .search-input:focus {
        outline: none; /* Eliminar el outline por defecto */
        border: 3px solid var(--accent-purple); /* Borde visible */
        outline-offset: 4px; /* Separación del borde */
        box-shadow: 0 0 15px rgba(147, 51, 234, 0.7); /* Sombra para resaltar */
        transform: scale(1.03) translateY(-2px); /* Transición suave de movimiento */
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border 0.2s ease-out;
    }

    /* Transiciones suaves y sencillas para el foco */
    .content-card, 
    .nav-item,
    .header-btn,
    .hero-btn,
    .action-btn,
    .episode-card {
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border 0.2s ease-out, background 0.2s ease;
    }
    
    /* Hover/Focus en tarjetas de contenido */
    .content-card:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 30px rgba(147, 51, 234, 0.5);
    }
    .content-card:focus {
        transform: scale(1.05); /* Ligeramente más grande que hover para foco */
        box-shadow: 0 10px 30px rgba(147, 51, 234, 0.9);
    }
    
    /* Mejorar tamaño de fuente y padding para TV */
    .hero-title { font-size: 5rem; }
    .section-title { font-size: 28px; }
    .nav-item { font-size: 18px; }
    .header-content { max-width: 1900px; }
    .content-section { padding: 0 80px; }
    .detail-content { padding: 40px 80px; }
    
    /* Mostrar siempre el título de la tarjeta en TV para fácil identificación */
    .card-title-overlay {
        opacity: 1 !important;
        background: linear-gradient(to top, rgba(0,0,0,0.9), transparent) !important;
    }
}

/* Fix para el reproductor Plyr/HLS */
.plyr {
    border-radius: 0;
    max-height: 100vh;
}
.plyr--full-screen {
    max-width: 100vw;
    max-height: 100vh;
}

/* Contenedor de la cuadrícula para la carga infinita */
.content-grid-container {
    padding: 0 60px; /* Mantener el padding de la sección */
}

/* Asegurar que las secciones tienen un tamaño mínimo para el IntersectionObserver */
.content-grid {
    min-height: 500px; /* Para que el observer funcione en el primer lote */
}

/* Loader del infinite scroll */
.infinite-scroll-loader {
    text-align: center;
    padding: 20px 0;
    font-size: 16px;
    color: var(--text-secondary);
}

/* --- Resto de Estilos (Mantener los originales) --- */
/* ... (Se mantiene el resto del CSS original) ... */
/* Asegúrate de que los estilos originales estén aquí para un CSS completo */
:root { /* ... variables ... */ }
* { /* ... box-sizing ... */ }
/* ... (Resto de estilos originales: Loader, Header, Main Content, Hero, Content Sections, Detail Screen, Search Modal, etc.) ... */
/* --- Loader --- */ .loader-container { position: fixed; inset: 0; background: var(--primary-bg); display: flex; justify-content: center; align-items: center; z-index: 1000; transition: opacity 0.5s ease; } .loader { width: 60px; height: 60px; border: 3px solid rgba(147, 51, 234, 0.3); border-top: 3px solid var(--accent-purple); border-radius: 50%; animation: spin 1s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .loader-container.hidden { opacity: 0; pointer-events: none; } /* --- Header --- */ .header { position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(to bottom, rgba(10, 10, 10, 0.95) 0%, rgba(10, 10, 10, 0) 100%); padding: 16px 20px; z-index: 100; transition: all 0.3s ease; backdrop-filter: blur(10px); } .header-content { display: flex; align-items: center; justify-content: space-between; max-width: 1400px; margin: 0 auto; } .logo { font-family: 'Space Grotesk', sans-serif; font-size: 28px; font-weight: 700; background: var(--gradient-1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-decoration: none; letter-spacing: -1px; } .nav-menu { display: flex; gap: 24px; align-items: center; } .nav-item { color: var(--text-secondary); text-decoration: none; font-size: 14px; font-weight: 500; transition: color 0.2s ease; position: relative; } .nav-item:hover, .nav-item.active { color: var(--text-primary); } .nav-item.active::after { content: ''; position: absolute; bottom: -4px; left: 0; right: 0; height: 2px; background: var(--accent-purple); } .header-actions { display: flex; gap: 16px; align-items: center; } .header-btn { background: var(--glass-bg); border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; color: var(--text-primary); backdrop-filter: blur(10px); } .header-btn:hover { background: rgba(147, 51, 234, 0.2); transform: scale(1.1); } /* --- Main Content --- */ .main-content { padding-top: 80px; min-height: 100vh; padding-bottom: 80px; } .screen { display: none; animation: fadeIn 0.3s ease; } .screen.active { display: block; } @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } } /* --- Hero Section --- */ .hero-section { position: relative; height: 80vh; overflow: hidden; margin-bottom: 40px; } .hero-background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; transition: transform 0.8s ease; filter: brightness(0.4); } .hero-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient( to bottom, transparent 0%, rgba(0, 0, 0, 0.5) 50%, rgba(0, 0, 0, 0.9) 100% ); } .hero-content { position: absolute; bottom: 20%; left: 60px; max-width: 600px; z-index: 10; } .hero-title { font-family: 'Space Grotesk', sans-serif; font-size: 4rem; font-weight: 700; margin: 0 0 20px 0; text-shadow: 2px 2px 20px rgba(0,0,0,0.8); line-height: 1.1; background: linear-gradient(135deg, #ffffff 0%, #ec4899 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; } .hero-description { display: none; } .hero-actions { display: flex; gap: 20px; align-items: center; flex-wrap: wrap; } .hero-btn { display: flex; align-items: center; gap: 12px; padding: 14px 28px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; } .hero-btn-primary { background: var(--gradient-1); color: white; } .hero-btn-primary:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(147, 51, 234, 0.3); } .hero-btn-secondary { background: var(--glass-bg); color: white; backdrop-filter: blur(10px); border: 1px solid var(--border-color); } .hero-btn-secondary:hover { background: rgba(255, 255, 255, 0.1); } /* --- Content Sections --- */ .content-section { padding: 0 60px; margin-bottom: 50px; } .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; } .section-title { font-size: 24px; font-weight: 700; margin: 0; color: var(--text-primary); } .section-subtitle { color: var(--text-secondary); font-size: 14px; } .content-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 0 0; } .card { aspect-ratio: 3/4; background: var(--card-bg); border-radius: 8px; cursor: pointer; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,.2); transition: transform 0.2s ease, box-shadow 0.2s ease; } .card img { width: 100%; height: 100%; object-fit: cover; display: block; } .card h3 { display: none; } a { text-decoration: none; color: inherit; } .row { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 10px 20px; } .episode-description, .card-overlay, .card-meta { display: none; } .nav-link, .nav-item { text-decoration: none; } .content-card { display: block; position: relative; } .content-card .card-image { width: 100%; height: 100%; object-fit: cover; } .content-card .card-overlay, .content-card .card-title, .content-card .card-meta { display: none; } .season-indicator { position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: var(--gradient-1); color: white; padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; opacity: 0; transition: opacity 0.3s ease; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.3); } .content-card:hover .season-indicator { opacity: 1; } .content-card { position: relative; margin-top: 12px; } .content-grid .season-indicator, .search-grid .season-indicator, #movies-content .season-indicator, #series-content .season-indicator, #favorites-content .season-indicator { display: block !important; } .content-card.movie .season-indicator { display: none !important; } /* --- Detail Screen --- */ .detail-screen { min-height: 100vh; background: var(--primary-bg); } .detail-hero { position: relative; height: 70vh; overflow: hidden; } .detail-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; } .detail-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient( to bottom, transparent 0%, rgba(0, 0, 0, 0.7) 50%, var(--primary-bg) 100% ); } .detail-content { position: relative; z-index: 10; padding: 40px 60px; max-width: 1200px; margin: 0 auto; } .detail-header { display: flex; align-items: flex-start; justify-content: space-between; gap: 40px; margin-bottom: 40px; } .detail-info { flex: 1; } .detail-title { font-size: 3rem; font-weight: 700; margin: 0 0 20px 0; line-height: 1.2; color: var(--text-primary); } .detail-meta { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; } .meta-item { display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 14px; } .detail-actions { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; } .action-btn { display: flex; align-items: center; gap: 8px; padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; } .action-btn-primary { background: var(--gradient-1); color: white; } .action-btn-primary:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(147, 51, 234, 0.3); } .action-btn-secondary { background: var(--card-bg); color: var(--text-primary); border: 1px solid var(--border-color); } .action-btn-secondary:hover { background: var(--secondary-bg); border-color: var(--accent-purple); } .detail-description { font-size: 16px; line-height: 1.7; color: var(--text-secondary); max-width: 700px; } /* --- Episodes Grid --- */ .episodes-section { margin-top: 40px; } .episodes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; } .episode-card { background: var(--card-bg); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s ease; border: 1px solid var(--border-color); position: relative; } .episode-card:hover { background: var(--secondary-bg); border-color: var(--accent-purple); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(147, 51, 234, 0.2); } .episode-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; } .episode-number { font-size: 14px; font-weight: 600; color: var(--accent-purple); } .episode-duration { font-size: 12px; color: var(--text-secondary); } .episode-title { font-size: 16px; font-weight: 600; margin: 0 0 8px 0; } .episode-indicator { position: absolute; top: 8px; right: 8px; width: 8px; height: 8px; background: var(--watched-color); border-radius: 50%; opacity: 0; transition: opacity 0.2s ease; } .episode-card.watched .episode-indicator { opacity: 1; } /* --- Search Modal --- */ .search-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--primary-bg); z-index: 999; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); display: flex; flex-direction: column; } .search-modal.active { transform: translateY(0); } .search-header { padding: 20px 60px; background: var(--secondary-bg); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 20px; } .search-back { background: none; border: none; color: var(--text-primary); font-size: 24px; cursor: pointer; padding: 8px; border-radius: 50%; transition: background-color 0.2s ease; } .search-back:hover { background: var(--card-bg); } .search-input { flex: 1; padding: 16px 24px; border: 2px solid var(--border-color); border-radius: 12px; background: var(--card-bg); color: var(--text-primary); font-size: 18px; outline: none; transition: border-color 0.2s ease; } .search-input:focus { border-color: var(--accent-purple); } .search-results { flex: 1; padding: 20px 60px; overflow-y: auto; } .search-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 0 20px; } /* --- Bottom Navigation --- */ .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--secondary-bg); border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; align-items: center; height: 70px; z-index: 100; padding-bottom: env(safe-area-inset-bottom); } .nav-tab { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--text-secondary); transition: color 0.2s ease; padding: 8px; min-width: 60px; } .nav-tab.active { color: var(--accent-purple); } .nav-tab:hover { color: var(--text-primary); } .nav-icon { font-size: 20px; margin-bottom: 4px; } .nav-label { font-size: 11px; font-weight: 500; } /* --- Responsive --- */ @media (max-width: 768px) { .header { padding: 12px 16px; } .nav-menu { display: none; } .hero-content { left: 20px; right: 20px; max-width: none; } .hero-title { font-size: 2.5rem; } .content-section, .detail-content, .search-header, .search-results { padding-left: 20px; padding-right: 20px; } .content-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; } .detail-header { flex-direction: column; gap: 20px; } .detail-title { font-size: 2rem; } } @media (max-width: 480px) { .hero-title { font-size: 2rem; } .hero-actions { flex-direction: column; align-items: stretch; gap: 15px; } .hero-btn { width: 100%; justify-content: center; } .content-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; } } /* PWA Install Prompt */ .install-prompt { position: fixed; bottom: 80px; left: 20px; right: 20px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px; display: none; align-items: center; justify-content: space-between; z-index: 200; backdrop-filter: blur(10px); } .install-prompt.show { display: flex; } .install-prompt-content { flex: 1; } .install-prompt-title { font-size: 16px; font-weight: 600; margin: 0 0 4px 0; } .install-prompt-text { font-size: 14px; color: var(--text-secondary); } .install-prompt-buttons { display: flex; gap: 8px; } .install-prompt-btn { background: var(--accent-purple); border: none; color: white; padding: 8px 16px; border-radius: 8px; font-size: 14px; cursor: pointer; transition: background-color 0.2s ease; } .install-prompt-btn:hover { background: var(--accent-pink); } .install-prompt-close { background: none; border: none; color: var(--text-secondary); font-size: 20px; cursor: pointer; padding: 4px; margin-left: 8px; } /* Enlaces de video con estilo mejorado */ .video-link { display: block; width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 5; cursor: pointer; } .content-card { position: relative; overflow: hidden; cursor: pointer; } /* Indicador de reproducción */ .play-indicator { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(147, 51, 234, 0.9); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; opacity: 0; transition: opacity 0.3s ease; z-index: 3; } .content-card:hover .play-indicator { opacity: 1; } /* Guardar progreso visual */ .progress-bar { position: absolute; bottom: 0; left: 0; right: 0; height: 4px; background: rgba(255,255,255,0.2); z-index: 4; } .progress-fill { height: 100%; background: var(--accent-purple); width: 0%; transition: width 0.3s ease; } /* Agregar estilos para el título de las tarjetas */ .card-title-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); color: white; padding: 20px 10px 10px; font-size: 14px; font-weight: 600; text-align: center; opacity: 0; transition: opacity 0.3s ease; z-index: 2; } .content-card:hover .card-title-overlay { opacity: 1; } /* Botón de retroceso mejorado para series */ .series-back-btn { position: absolute; top: 20px; left: 20px; width: 48px; height: 48px; background: rgba(0,0,0,0.8); border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 10; font-size: 18px; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.3); } .content-card:hover .series-back-btn { opacity: 1; transform: translateY(0); } .series-back-btn:hover { background: var(--accent-purple); border-color: var(--accent-purple); transform: scale(1.1) translateY(-2px); box-shadow: 0 8px 25px rgba(147, 51, 234, 0.4); } /* Botón de retroceso en el header de series */ #series-back-btn { position: static; width: 40px; height: 40px; margin-right: 15px; background: var(--glass-bg); border: 1px solid var(--border-color); opacity: 1; transform: none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); } #series-back-btn:hover { background: var(--accent-purple); border-color: var(--accent-purple); transform: scale(1.05); box-shadow: 0 4px 15px rgba(147, 51, 234, 0.3); } /* Botón de retroceso en detalle de episodios */ #series-back-to-series { position: static; margin-bottom: 25px; opacity: 1; display: inline-flex; align-items: center; gap: 12px; background: var(--glass-bg); border: 1px solid var(--border-color); padding: 12px 20px; border-radius: 12px; font-size: 14px; font-weight: 500; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); } #series-back-to-series:hover { background: var(--accent-purple); border-color: var(--accent-purple); transform: translateX(-4px); box-shadow: 0 6px 20px rgba(147, 51, 234, 0.4); } /* Animación de entrada para botones */ .series-back-btn, #series-back-btn, #series-back-to-series { animation: slideInFromLeft 0.5s ease-out; } @keyframes slideInFromLeft { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } } /* Efecto de brillo en hover */ .series-back-btn::before, #series-back-btn::before, #series-back-to-series::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.6s ease; } .series-back-btn:hover::before, #series-back-btn:hover::before, #series-back-to-series:hover::before { left: 100%; } /* Estilo para el efecto ripple */ .ripple { position: absolute; border-radius: 50%; background: rgba(255,255,255,0.6); transform: scale(0); animation: ripple-animation 0.6s ease-out; pointer-events: none; } @keyframes ripple-animation { to { transform: scale(4); opacity: 0; } } /* Posición relativa para los botones con ripple */ .series-back-btn, #series-back-btn, #series-back-to-series { position: relative; overflow: hidden; } /* --- Botón de retroceso para series (versión mejorada) --- */ .content-card.series .series-back-btn { display: none; } /* --- Download Modal Styles --- */ .download-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 20000; backdrop-filter: blur(10px); } .download-btn-floating { position: fixed; top: 50%; right: 20px; transform: translateY(-50%); width: 60px; height: 60px; background: var(--gradient-1); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 20px rgba(147, 51, 234, 0.4); z-index: 10001; animation: pulse 2s infinite; cursor: pointer; } @keyframes pulse { 0%, 100% { transform: translateY(-50%) scale(1); } 50% { transform: translateY(-50%) scale(1.1); } } /* --- Custom Player Styles --- */ #custom-player { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: flex; flex-direction: column; } #custom-player header { background: rgba(0,0,0,0.8); padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; backdrop-filter: blur(10px); } #custom-player header h3 { color: white; margin: 0; font-size: 18px; } #custom-player header button { background: none; border: none; color: white; font-size: 24px; cursor: pointer; } #player-video { max-width: 100%; max-height: 100%; } /* --- Download Modal Animation --- */ @keyframes slideInUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } } /* Reproductor de video nativo */ #player { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; } #video-player { width: 100%; height: 100%; object-fit: contain; } /* Animación para el modal de descarga */ @keyframes slideInUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } } /* Botón de descarga flotante */ .download-btn-floating { position: fixed; top: 50%; right: 20px; transform: translateY(-50%); width: 60px; height: 60px; background: var(--gradient-1); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 20px rgba(147, 51, 234, 0.4); z-index: 10001; animation: pulse 2s infinite; cursor: pointer; } @keyframes pulse { 0%, 100% { transform: translateY(-50%) scale(1); } 50% { transform: translateY(-50%) scale(1.1); } }
</style>
</head>
<body>
<div id="loader" class="loader-container">
    <div class="loader"></div>
</div>

<header class="header">
    <div class="header-content">
        <a href="#" class="logo" data-screen="home">Kawaii Play</a>
        <nav class="nav-menu">
            <a href="#" class="nav-item active" data-screen="home" tabindex="1">Inicio</a>
            <a href="#" class="nav-item" data-screen="movies" tabindex="2">Películas</a>
            <a href="#" class="nav-item" data-screen="series" tabindex="3">Series</a>
            <a href="#" class="nav-item" data-screen="channels" tabindex="4">Canales</a>
            <a href="#" class="nav-item" data-screen="favorites" tabindex="5">Mi Lista</a>
        </nav>
        <div class="header-actions">
            <button id="search-btn" class="header-btn" tabindex="6"><i class="fas fa-search"></i></button>
        </div>
    </div>
</header>

<main class="main-content">
    <div id="home" class="screen active">
        <section class="hero-section">
            <div id="hero-bg" class="hero-background"></div>
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h1 id="hero-title" class="hero-title"></h1>
                <p id="hero-description" class="hero-description"></p>
                <div class="hero-actions">
                    <a id="hero-play" class="hero-btn hero-btn-primary" tabindex="7">
                        <i class="fas fa-play"></i>
                        <span>Reproducir</span>
                    </a>
                    <a id="hero-info" class="hero-btn hero-btn-secondary" tabindex="8">
                        <i class="fas fa-info-circle"></i>
                        <span>Más información</span>
                    </a>
                </div>
            </div>
        </section>
        <div id="home-content">
            </div>
    </div>

    <div id="movies" class="screen">
        <div class="content-section">
            <h2 class="section-title">Películas</h2>
            <div id="movies-content" class="content-grid">
                </div>
        </div>
    </div>

    <div id="series" class="screen">
        <div class="content-section">
            <div class="section-header">
                <h2 class="section-title">Series</h2>
            </div>
            <div id="series-content" class="content-grid">
                </div>
        </div>
    </div>

    <div id="channels" class="screen">
        <div class="content-section">
            <h2 class="section-title">Canales de TV</h2>
            <div id="channels-content" class="content-grid">
                </div>
        </div>
    </div>

    <div id="favorites" class="screen">
        <div class="content-section">
            <h2 class="section-title">Mi Lista</h2>
            <div id="favorites-content" class="content-grid">
                </div>
        </div>
    </div>

    <div id="detail" class="screen">
        <div class="detail-screen">
            <div class="detail-hero">
                <img id="detail-bg" class="detail-bg" src="" alt="">
                <div class="detail-overlay"></div>
                <button id="detail-close" class="player-close" tabindex="9"><i class="fas fa-arrow-left"></i></button>
            </div>
            <div class="detail-content">
                <div class="detail-header">
                    <div class="detail-info">
                        <button id="series-back-to-series" class="series-back-btn" style="position: static; margin-bottom: 20px; opacity: 1; display: flex; align-items: center; gap: 8px; background: var(--glass-bg); border: 1px solid var(--border-color); padding: 12px 20px; border-radius: 12px; font-size: 14px;" tabindex="10">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h1 id="detail-title" class="detail-title"></h1>
                        <div class="detail-meta">
                            <span class="meta-item" id="detail-year"></span>
                            <span class="meta-item" id="detail-rating"></span>
                            <span class="meta-item" id="detail-duration"></span>
                            <span class="meta-item" id="detail-genre"></span>
                        </div>
                        <div class="detail-actions">
                            <a id="detail-play" class="action-btn action-btn-primary" tabindex="11">
                                <i class="fas fa-play"></i>
                                <span>Reproducir</span>
                            </a>
                            <a id="detail-favorite" class="action-btn action-btn-secondary" tabindex="12">
                                <i class="fas fa-heart"></i>
                                <span>Mi Lista</span>
                            </a>
                        </div>
                        <p id="detail-description" class="detail-description"></p>
                    </div>
                </div>
                <div id="detail-episodes" class="episodes-section">
                    </div>
            </div>
        </div>
    </div>

    <div id="search-modal" class="search-modal">
        <div class="search-header">
            <button id="search-close" class="search-back"><i class="fas fa-arrow-left"></i></button>
            <input id="search-input" type="text" class="search-input" placeholder="Buscar películas, series..." tabindex="13">
        </div>
        <div class="search-results">
            <div id="search-grid" class="search-grid">
                </div>
        </div>
    </div>
</main>

<nav class="bottom-nav">
    <a href="#" class="nav-tab active" data-screen="home">
        <i class="fas fa-home nav-icon"></i> <span class="nav-label">Inicio</span>
    </a>
    <a href="#" class="nav-tab" data-screen="movies">
        <i class="fas fa-film nav-icon"></i> <span class="nav-label">Películas</span>
    </a>
    <a href="#" class="nav-tab" data-screen="series">
        <i class="fas fa-tv nav-icon"></i> <span class="nav-label">Series</span>
    </a>
    <a href="#" class="nav-tab" data-screen="channels">
        <i class="fas fa-broadcast-tower nav-icon"></i> <span class="nav-label">Canales</span>
    </a>
    <a href="#" class="nav-tab" data-screen="favorites">
        <i class="fas fa-star nav-icon"></i> <span class="nav-label">Mi Lista</span>
    </a>
</nav>

<div id="player" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999;">
    <video id="video-player" style="width: 100%; height: 100%; object-fit: contain;" controls crossorigin playsinline></video>
</div>

<script>
// --- Constantes para Infinite Scroll ---
const ITEMS_PER_LOAD = 30; // Cargar de 30 en 30
let movieLoadIndex = 0;
let seriesLoadIndex = 0;
let currentMovieObserver = null;
let currentSeriesObserver = null;

// Service Worker Registration (Mantener)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => console.log('ServiceWorker registered'))
            .catch(err => console.log('ServiceWorker registration failed'));
    });
}

// PWA Install Prompt (Mantener)
let deferredPrompt;
const installPrompt = document.createElement('div');
// ... (código del PWA Install Prompt) ...

// DOM Elements
const loader = document.getElementById('loader');
const screens = document.querySelectorAll('.screen');
const navItems = document.querySelectorAll('.nav-item, .nav-tab');
const searchModal = document.getElementById('search-modal');
const searchInput = document.getElementById('search-input');
const videoPlayerElement = document.getElementById('video-player');
const playerContainer = document.getElementById('player');

// State
let allData = { movies: [], series: [] };
let favorites = JSON.parse(localStorage.getItem('kawaii_favorites')) || [];
let currentHeroIndex = 0;
let heroInterval;
let heroFeatured = [];
let channels = [];
let plyrInstance = null; // Instancia de Plyr

// Utility Functions (Mantener)
function switchScreen(screenId) {
    screens.forEach(screen => screen.classList.remove('active'));
    const targetScreen = document.getElementById(screenId);
    if (targetScreen) targetScreen.classList.add('active');

    // Desconectar observadores al cambiar de pantalla
    if (currentMovieObserver) currentMovieObserver.disconnect();
    if (currentSeriesObserver) currentSeriesObserver.disconnect();
    
    // Si vamos a la pantalla de películas o series, empezar a renderizar
    if (screenId === 'movies') renderMovies(true);
    if (screenId === 'series') renderSeries(true);
    if (screenId === 'favorites') renderFavorites();

    // Update navigation active states
    navItems.forEach(item => item.classList.remove('active'));
    document.querySelectorAll(`[data-screen="${screenId}"]`).forEach(item => {
        item.classList.add('active');
        // Asegurar que el primer elemento enfocable en la nueva pantalla tenga el foco en TV
        if (item.classList.contains('active') && window.innerWidth >= 769) {
            const firstFocusable = targetScreen.querySelector('.content-card, .hero-btn, .action-btn, .nav-item, .header-btn');
            if (firstFocusable) firstFocusable.focus();
        }
    });
}
function formatTime(seconds) { /* ... */ }
function saveVideoProgress(itemId, episodeIndex, currentTime, duration) { /* ... */ }
function isEpisodeWatched(seriesTitle, episodeIndex) { /* ... */ }
function getProgressPercentage(itemId, episodeIndex) { /* ... */ }

// Data Loading (Mantener)
const DATA_URL = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/data.json";
async function loadData() { /* ... */ }
async function loadChannels() { /* ... */ }

// Hero Section (Mantener)
function setupHero() { /* ... */ }

// --- Content Rendering (MODIFICADO para Infinite Scroll) ---

function createContentCard(item) {
    const card = document.createElement('div');
    card.className = 'content-card';
    card.tabIndex = 0; // Añadir tabindex para hacerlo enfocable con el control remoto

    // ... (El resto de la creación de la tarjeta)
    if (item.episodes) { card.classList.add('series'); } else if (item.url) { card.classList.add('channel'); } else { card.classList.add('movie'); }
    const img = document.createElement('img'); img.className = 'card-image'; img.src = item.poster || item.coverImage || item.logo || ''; img.alt = item.title || item.name; img.loading = 'lazy';
    const titleOverlay = document.createElement('div'); titleOverlay.className = 'card-title-overlay'; titleOverlay.textContent = item.title || item.name;
    const videoLink = document.createElement('a'); videoLink.className = 'video-link'; videoLink.href = '#'; videoLink.innerHTML = '<div class="play-indicator"><i class="fas fa-play"></i></div>';
    
    videoLink.onclick = (e) => {
        e.preventDefault();
        if (item.url) { playVideo(item.url, item.title); } 
        else if (item.video_url) { playVideo(item.video_url, item.title); } 
        else if (item.episodes) { showDetail(item); }
    };

    card.appendChild(img);
    card.appendChild(titleOverlay);
    card.appendChild(videoLink);
    return card;
}

function renderContentGrid(data, containerId, startIndex, limit, itemType, loadFunction) {
    const container = document.getElementById(containerId);
    
    // Si es el primer render, limpiar y añadir el contenedor de la cuadrícula
    if (startIndex === 0) {
        container.innerHTML = '';
        container.dataset.nextIndex = ITEMS_PER_LOAD;
        container.dataset.hasMore = 'true';
    }

    const endIndex = Math.min(startIndex + limit, data.length);
    const fragment = document.createDocumentFragment();

    for (let i = startIndex; i < endIndex; i++) {
        fragment.appendChild(createContentCard(data[i]));
    }

    container.appendChild(fragment);

    // Si había un loader, quitarlo
    const existingLoader = container.querySelector('.infinite-scroll-loader');
    if (existingLoader) existingLoader.remove();

    // Comprobar si hay más elementos
    if (endIndex < data.length) {
        container.dataset.nextIndex = endIndex;
        container.dataset.hasMore = 'true';

        // Añadir elemento sentinel para IntersectionObserver
        const sentinel = document.createElement('div');
        sentinel.className = 'infinite-scroll-loader';
        sentinel.textContent = 'Cargando más...';
        container.appendChild(sentinel);
        
        // Configurar IntersectionObserver
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && container.dataset.hasMore === 'true') {
                    observer.unobserve(entry.target); // Dejar de observar el sentinel actual
                    loadFunction(false); // Cargar el siguiente lote
                }
            });
        }, { threshold: 0.1 });

        observer.observe(sentinel);
        
        // Guardar el observador actual
        if (containerId === 'movies-content') currentMovieObserver = observer;
        if (containerId === 'series-content') currentSeriesObserver = observer;
    } else {
        container.dataset.hasMore = 'false';
    }
}

function renderMovies(reset = false) {
    if (reset) movieLoadIndex = 0;
    const container = document.getElementById('movies-content');
    const startIndex = reset ? 0 : parseInt(container.dataset.nextIndex) || 0;
    
    if (reset || container.dataset.hasMore !== 'false') {
        renderContentGrid(allData.movies, 'movies-content', startIndex, ITEMS_PER_LOAD, 'movie', renderMovies);
    }
}

function renderSeries(reset = false) {
    if (reset) seriesLoadIndex = 0;
    const container = document.getElementById('series-content');
    const startIndex = reset ? 0 : parseInt(container.dataset.nextIndex) || 0;

    if (reset || container.dataset.hasMore !== 'false') {
        renderContentGrid(allData.series, 'series-content', startIndex, ITEMS_PER_LOAD, 'series', renderSeries);
    }
}

function renderFavorites() { 
    // ... (Mantener la función original, favoritos no usa carga infinita) ...
    const container = document.getElementById('favorites-content');
    container.innerHTML = '';
    const favItems = favorites.map(id => { return allData.movies.find(m => m.title === id) || allData.series.find(s => s.title === id); }).filter(Boolean);
    if (favItems.length === 0) { container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">No tienes contenido en tu lista</p>'; return; }
    favItems.forEach(item => { container.appendChild(createContentCard(item)); });
} 

function renderHome() { 
    // ... (Mantener la función original para la Home, usa slice(0, 8)) ...
    const homeContent = document.getElementById('home-content');
    homeContent.innerHTML = '';
    if (allData.movies.length > 0) {
        const moviesSection = document.createElement('div');
        moviesSection.className = 'content-section';
        moviesSection.innerHTML = `
            <div class="section-header"> <h2 class="section-title">Películas Populares</h2> </div>
            <div class="content-grid"> ${allData.movies.slice(0, 8).map(movie => `
                <div class="content-card movie" data-url="${movie.video_url}" data-title="${movie.title}" tabindex="0">
                    <img src="${movie.coverImage || movie.poster || ''}" alt="${movie.title}" class="card-image" loading="lazy">
                    <div class="card-title-overlay">${movie.title}</div>
                    <a href="#" class="video-link"> <div class="play-indicator"><i class="fas fa-play"></i></div> </a>
                    <div class="progress-bar"> <div class="progress-fill" style="width: ${getProgressPercentage(movie.title, 0)}%"></div> </div>
                </div> `).join('')}
            </div> `;
        homeContent.appendChild(moviesSection);
    }
    if (allData.series.length > 0) {
        const seriesSection = document.createElement('div');
        seriesSection.className = 'content-section';
        seriesSection.innerHTML = `
            <div class="section-header"> <h2 class="section-title">Series Destacadas</h2> </div>
            <div class="content-grid"> ${allData.series.slice(0, 8).map(series => `
                <div class="content-card series" data-series='${JSON.stringify(series)}' tabindex="0">
                    <img src="${series.coverImage || series.poster || ''}" alt="${series.title}" class="card-image" loading="lazy">
                    <div class="card-title-overlay">${series.title}</div>
                    <a href="#" class="video-link"> <div class="play-indicator"><i class="fas fa-play"></i></div> </a>
                    ${series.season ? `<div class="season-indicator">Temporada ${series.season}</div>` : ''}
                    <div class="progress-bar"> <div class="progress-fill" style="width: ${getProgressPercentage(series.title, 0)}%"></div> </div>
                </div> `).join('')}
            </div> `;
        homeContent.appendChild(seriesSection);
    }
    // Agregar event listeners
    homeContent.querySelectorAll('.content-card.movie').forEach(card => {
        card.addEventListener('click', (e) => { e.preventDefault(); const url = card.dataset.url; const title = card.dataset.title; if (url) playVideo(url, title); });
    });
    homeContent.querySelectorAll('.content-card.series').forEach(card => {
        card.addEventListener('click', (e) => { e.preventDefault(); const series = JSON.parse(card.dataset.series); showDetail(series); });
    });
} 

function renderChannels() { /* ... */ } // Mantener

// --- Video Player (MODIFICADO para Plyr/HLS) ---

function openVideoLink(url, itemId, episodeIndex = 0) {
    // 1. Destruir instancia anterior de Plyr si existe
    if (plyrInstance) {
        plyrInstance.destroy();
        plyrInstance = null;
    }

    // 2. Configurar el video
    const isHls = url.includes('.m3u8');
    
    // Restaurar progreso
    const progressKey = `progress_${itemId}_${episodeIndex}`;
    const savedProgress = localStorage.getItem(progressKey);
    const startProgress = savedProgress ? JSON.parse(savedProgress).currentTime : 0;
    
    // 3. Inicializar HLS si es necesario (para .m3u8)
    if (isHls && Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(videoPlayerElement);
        hls.on(Hls.Events.MANIFEST_PARSED, function () {
            videoPlayerElement.currentTime = startProgress;
            videoPlayerElement.play();
        });
    } else {
        // Reproducción directa (MP4, etc.)
        videoPlayerElement.src = url;
        videoPlayerElement.currentTime = startProgress;
    }

    // 4. Inicializar Plyr
    plyrInstance = new Plyr(videoPlayerElement, {
        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'settings', 'fullscreen'],
        i18n: { rewind: 'Rebobinar {seektime}s', seek: 'Saltar', speed: 'Velocidad', normal: 'Normal', quality: 'Calidad', settings: 'Ajustes', fullscreen: 'Pantalla completa', pip: 'PIP', play: 'Reproducir', pause: 'Pausa', 'seek-backward': 'Retroceder {seektime}s', 'seek-forward': 'Avanzar {seektime}s' },
        ratio: '16:9',
    });

    // 5. Mostrar reproductor
    playerContainer.style.display = 'block';

    // 6. Configurar eventos de progreso
    let progressTimer = null;
    plyrInstance.on('timeupdate', () => {
        // Guardar progreso cada 5 segundos para no sobrecargar localStorage
        if (!progressTimer) {
            progressTimer = setTimeout(() => {
                if (plyrInstance && plyrInstance.currentTime > 0) {
                    saveVideoProgress(itemId, episodeIndex, plyrInstance.currentTime, plyrInstance.duration);
                }
                progressTimer = null;
            }, 5000);
        }
    });

    plyrInstance.on('ended', () => {
        localStorage.removeItem(progressKey); // Eliminar el progreso al finalizar
        playerContainer.style.display = 'none';
        plyrInstance.destroy();
        plyrInstance = null;
    });

    plyrInstance.on('destroy', () => {
        // Asegurar que se guarda el progreso final al cerrar o destruir
        if (plyrInstance && plyrInstance.currentTime > 0) {
            saveVideoProgress(itemId, episodeIndex, plyrInstance.currentTime, plyrInstance.duration);
        }
        playerContainer.style.display = 'none';
    });

    // 7. Configurar cierre con tecla ESC (Crucial para TV)
    document.addEventListener('keydown', function closeOnEsc(e) {
        if (e.key === 'Escape' || e.key === 'Backspace' || e.key === 'GoBack') { // Teclas comunes de retroceso en TV
            if (plyrInstance) {
                plyrInstance.pause();
                plyrInstance.destroy();
                plyrInstance = null;
            }
            playerContainer.style.display = 'none';
            document.removeEventListener('keydown', closeOnEsc);
        }
    });

    // Forzar foco en el reproductor para asegurar el control remoto
    videoPlayerElement.focus();
}

function playVideo(url, title) {
    openVideoLink(url, title, 0);
}

// Detail Screen (Mantener, pero añadir tabindex)
function showDetail(item) {
    // ... (código showDetail) ...
    // Añadir tabindex=13 a los episode-card
    const episodeCards = document.querySelectorAll('.episode-card');
    episodeCards.forEach(card => card.tabIndex = 13);
    
    switchScreen('detail');
}
function renderEpisodes(series) { 
    // ... (código renderEpisodes) ...
    const episodesSection = document.getElementById('detail-episodes');
    episodesSection.innerHTML = '<h3 style="margin-bottom: 20px;">Episodios</h3>';
    const episodesGrid = document.createElement('div');
    episodesGrid.className = 'episodes-grid';
    series.episodes.forEach((episode, index) => {
        const episodeCard = document.createElement('a');
        episodeCard.className = 'episode-card';
        episodeCard.tabIndex = 0; // Hacer enfocable
        const isWatched = isEpisodeWatched(series.title, index);
        if (isWatched) { episodeCard.classList.add('watched'); }
        episodeCard.href = '#';
        episodeCard.innerHTML = `
            <div class="episode-indicator"></div>
            <div class="episode-header">
                <span class="episode-number">Episodio ${index + 1}</span>
                <span class="episode-duration">${episode.duration || 'N/A'}</span>
            </div>
            <p class="episode-description">${episode.description || 'Sin descripción'}</p>
        `;
        episodeCard.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.setItem(`watched_${series.title}_${index}`, 'true');
            episodeCard.classList.add('watched');
            openVideoLink(episode.video_url, series.title, index);
        });
        episodesGrid.appendChild(episodeCard);
    });
    episodesSection.appendChild(episodesGrid);
} 

function toggleFavorite(itemId) { /* ... */ }

// Search function (Mantener, pero asegurar tabindex para input)
function setupSearch() { 
    // ... (código setupSearch) ...
    document.getElementById('search-input').tabIndex = 0;
} 

// Navigation (MODIFICADO para usar switchScreen con lógica de renderizado)
navItems.forEach(item => {
    item.onclick = (e) => {
        e.preventDefault();
        const screen = e.target.closest('[data-screen]').dataset.screen;
        switchScreen(screen); // La función switchScreen ahora maneja el renderizado de películas/series
    };
});
document.getElementById('detail-close').onclick = () => switchScreen('home');

// Initialization (Mantener)
async function init() {
    await loadData();
    channels = await loadChannels();
    setupHero();
    setupSearch();
    renderHome();
    renderChannels();
    setTimeout(() => { loader.classList.add('hidden'); }, 1000);
}

// Start the app
init();

// Agregar efecto de ripple a los botones de retroceso (Mantener)
document.addEventListener('click', (e) => { /* ... */ });
</script>
</body>
</html>
