<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root { --bg: #000; --accent: #00e1b5; --card: #111; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; }
        .search-header { position: sticky; top: 0; background: #000; padding: 15px; z-index: 100; border-bottom: 1px solid #222; display: flex; align-items: center; gap: 10px; }
        .search-input-cont { flex: 1; background: #111; display: flex; align-items: center; padding: 10px 15px; border: 1px solid var(--accent); border-radius: 5px; }
        .search-input-cont input { flex: 1; background: transparent; border: none; color: white; outline: none; }
        .res-ch { display: flex; align-items: center; background: var(--card); margin-bottom: 10px; padding: 10px; border-radius: 5px; }
        .res-ch img { width: 60px; height: 35px; object-fit: cover; margin-right: 15px; }
        .grid-results { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .res-poster { aspect-ratio: 2/3; background: var(--card); border: 1px solid #222; border-radius: 4px; overflow: hidden; }
        .res-poster img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>
    <div class="search-header"><i class="fas fa-arrow-left" onclick="history.back()"></i><div class="search-input-cont"><input type="text" id="q" placeholder="Buscar..." oninput="buscarTodo()" autofocus></div></div>
    <main id="results" style="padding:15px">
        <div id="cat-channels"></div>
        <div id="cat-content"></div>
    </main>
    <script>
        const M3U = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/CV.m3u8";
        const DATA = "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/data.json";
        let dbChannels = []; let dbContent = [];
        async function preCargar() {
            try {
                const [r1, r2] = await Promise.all([fetch(M3U).then(res => res.text()), fetch(DATA).then(res => res.json())]);
                const lines = r1.split('\n');
                lines.forEach((l, i) => {
                    if (l.includes('#EXTINF:')) {
                        const url = lines[i+1]?.trim();
                        if(url && url.startsWith('http')) {
                            dbChannels.push({ n: l.split(',')[1]?.trim().toLowerCase(), nameReal: l.split(',')[1]?.trim(), u: url, img: l.match(/tvg-logo="(.*?)"/)?.[1] || "" });
                        }
                    }
                });
                dbContent = r2;
            } catch(e) { console.error(e); }
        }
        function buscarTodo() {
            const q = document.getElementById('q').value.toLowerCase().trim();
            const resCh = document.getElementById('cat-channels'); const resCo = document.getElementById('cat-content');
            if(q.length < 2) { resCh.innerHTML = ''; resCo.innerHTML = ''; return; }
            const foundCh = dbChannels.filter(c => c.n.includes(q));
            resCh.innerHTML = foundCh.length ? '<h3 style="color:var(--accent)">Canales</h3>' : '';
            foundCh.forEach(c => {
                const div = document.createElement('div'); div.className = 'res-ch';
                div.innerHTML = `<img src="${c.img}"><span>${c.nameReal}</span>`;
                div.onclick = () => { localStorage.setItem('pbox_url', c.u); localStorage.setItem('pbox_title', c.nameReal); window.location.href = "player.html"; };
                resCh.appendChild(div);
            });
            const foundCo = dbContent.filter(c => c.title.toLowerCase().includes(q));
            resCo.innerHTML = foundCo.length ? '<h3 style="color:var(--accent)">Contenido</h3><div class="grid-results" id="g-res"></div>' : '';
            if(foundCo.length) {
                const grid = document.getElementById('g-res');
                foundCo.forEach(item => {
                    const d = document.createElement('div'); d.className = 'res-poster';
                    d.innerHTML = `<img src="${item.coverImage}">`;
                    d.onclick = () => {
                        if(item.episodes) { localStorage.setItem('pbox_serie', JSON.stringify(item)); window.location.href = "capitulos.html"; }
                        else { localStorage.setItem('pbox_url', item.video_url); localStorage.setItem('pbox_title', item.title); window.location.href = "player.html"; }
                    };
                    grid.appendChild(d);
                });
            }
        }
        preCargar();
    </script>
</body>
</html>
