// Reemplaza el script de canales.html con este:
let dbChannels = [];
let displayedIndex = 0;
const step = 30;

fetch("https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/CV.m3u8")
.then(res => res.text()).then(text => {
    const lines = text.split('\n');
    lines.forEach((l, i) => {
        if(l.includes('#EXTINF:')) {
            const url = lines[i+1]?.trim();
            if(url && url.startsWith('http')) {
                dbChannels.push({
                    logo: l.match(/tvg-logo="(.*?)"/)?.[1] || '',
                    url: url
                });
            }
        }
    });
    renderChannels();
});

function renderChannels() {
    const grid = document.getElementById('grid-ch');
    const chunk = dbChannels.slice(displayedIndex, displayedIndex + step);
    chunk.forEach(c => {
        const d = document.createElement('div');
        d.className = 'card-ch';
        d.innerHTML = `<img src="${c.logo}">`;
        d.onclick = () => { localStorage.setItem('pbox_url', c.url); window.location.href="player.html"; };
        grid.appendChild(d);
    });
    displayedIndex += step;
}

window.onscroll = () => {
    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200) {
        if(displayedIndex < dbChannels.length) renderChannels();
    }
};
